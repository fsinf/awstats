Description: Fix directory traversal vulnerability (CVE-2010-4369) via
 crafted LoadPlugin directory.
Origin: http://awstats.cvs.sourceforge.net/viewvc/awstats/awstats/wwwroot/cgi-bin/awstats.pl?r1=1.966&r2=1.967
Bug: http://sourceforge.net/tracker/index.php?func=detail&aid=2537928&group_id=13764&atid=113764
Bug-Debian: http://bugs.debian.org/606263

--- a/wwwroot/cgi-bin/awstats.pl
+++ b/wwwroot/cgi-bin/awstats.pl
@@ -3058,8 +3058,8 @@
 		  "";    # If split has only on part, pluginparam is not initialized
 		$pluginfile =~ s/\.pm$//i;
 		$pluginfile =~ /([^\/\\]+)$/;
-		my $pluginname = $1;    # pluginname is pluginfile without any path
-		                        # Check if plugin is not disabled
+		$pluginfile = Sanitize($1);     # pluginfile is cleaned from any path for security reasons and from .pm
+		my $pluginname = $pluginfile;
 		if ( $NoLoadPlugin{$pluginname} && $NoLoadPlugin{$pluginname} > 0 ) {
 			if ($Debug) {
 				debug(
@@ -7724,10 +7724,10 @@
 	my $stringtoclean = shift;
 	my $full = shift || 0;
 	if ($full) {
-		$stringtoclean =~ s/[^\w]//g;
+		$stringtoclean =~ s/[^\w\d]//g;
 	}
 	else {
-		$stringtoclean =~ s/[^\w\-\\\/\.:\s]//g;
+		$stringtoclean =~ s/[^\w\d\-\\\/\.:\s]//g;
 	}
 	return $stringtoclean;
 }
